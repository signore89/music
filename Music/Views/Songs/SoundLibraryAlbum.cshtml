@model List<Song>
@{
    ViewData["Title"] = String.Concat("трэки альбома - ",ViewBag.Album);
    // var pager = new PageViewModel();
    // var pageNo = 0;
    // if (ViewBag.Pager != null)
    // {
    //     pager = ViewBag.Pager;
    //     pageNo = pager.CurrentPage;
    // }
}
<!-- Основное содержимое -->
<p>
    @if (User.IsInRole("Admin"))
    {
        <a asp-action="Create" asp-route-idAlbum="@ViewBag.AlbumId"
           class="btn btn-primary">
            <i class="bi bi-pencil"></i> Добавить трек в альбом
        </a>
    }

</p>
<div class="container">
    <div class="row">
        <!-- Список треков -->
        <div class="col-lg-8">
            <h2 class="mb-4">Песни</h2>

            <div class="track-list">
                @foreach (var song in Model)
                {
                    <div class="track-item">
                        <div class="track-info">
                            <h6 class="mb-0">@song.Name</h6>
                        </div>
                        <audio controls class="audio-player">
                            <source src="@song.UrlSong" type="audio/mpeg">
                            Ваш браузер не поддерживает аудио элемент.
                        </audio>
                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-action="Edit" asp-route-id="@song.Id"
                               class="btn btn-outline-warning btn-sm">
                                <i class="bi bi-pencil"></i> Изменить
                            </a>
                        }
                        else if (User.IsInRole("User"))
                        {
                            <button class="favorite-btn @((ViewBag.UserFavoritesSongs as ICollection<int>).Contains(song.Id) ? "active" : "")"
                                    data-id="@song.Id">
                                @if ((ViewBag.UserFavoritesSongs as ICollection<int>).Contains(song.Id))
                                {
                                    <span>★ В избранном</span>
                                }
                                else
                                {
                                    <span>☆ Добавить в избранное</span>
                                }
                            </button>
                        }
                        
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.favorite-btn').click(function() {
                var btn = $(this);
                var songId = btn.data('id');

                if (btn.hasClass('active')) {
                    $.post('@Url.Action("RemoveSong", "Favorites")', { songId: songId }, function() {
                        btn.removeClass('active');
                        btn.html('<span>☆ Добавить в избранное</span>');
                    });
                } else {
                    $.post('@Url.Action("AddSong", "Favorites")', { songId: songId }, function() {
                        btn.addClass('active');
                        btn.html('<span>★ В избранном</span>');
                    });
                }
            });
        });
    </script>
}
